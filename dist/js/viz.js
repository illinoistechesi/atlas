(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var fillText = function fillText(tag, text) {
	var spans = document.getElementsByClassName(tag);
	for (var s = 0; s < spans.length; s++) {
		var span = spans[s];
		span.innerText = text;
	}
};

var atlas = Atlas();

atlas.init().then(function (done) {

	var mapOptions = {
		zoom: 15,
		center: new google.maps.LatLng(41.259716, -95.960588),
		styles: atlas.removeThemeLabels(MAP_STYLES)
	};

	var mapElement = document.getElementById('map');

	var map = new google.maps.Map(mapElement, mapOptions);
	window.mapRef = map;
	atlas.setMap(map);

	var mapThemeTag = localStorage.getItem('map-theme-tag');
	var mapThemeStyle = localStorage.getItem('map-theme-style');
	if (mapThemeTag && mapThemeStyle) {
		var theme = JSON.parse(mapThemeStyle);
		atlas.changeMapStyle(map, mapThemeTag, theme);
	}

	var renderSimulationFromString = function renderSimulationFromString(value) {
		var simulationData = [];
		var peakInfection = 0;
		value.split('%').forEach(function (inLine) {
			var line = inLine.trim();
			var parts = line.split(':');
			var time = parseInt(parts[0]);
			var locations = [];
			if (parts[1]) {
				parts[1].split('$').forEach(function (val) {
					var data = val.split(',');
					var lidx = parseInt(data[0]);
					var infected = parseInt(data[1]);
					locations[lidx] = {
						id: lidx,
						infected: infected
					};
					if (infected > peakInfection) {
						peakInfection = infected;
					}
				});
			}
			simulationData.push({
				time: time,
				locations: locations
			});
		});

		var renderAtTime = function renderAtTime(val) {
			fillText('fill-sim-time', val);
			var data = simulationData[val];
			if (data) {
				atlas.updateIcons(atlas.markers, function (icon, entry, idx) {
					var location = data.locations[idx] || {};
					var inf = location.infected || 0;
					var ratio = inf / peakInfection;
					icon.scale = 1.0 + 9.0 * ratio;
					entry.data.time = val;
					entry.data.infected = inf;
					return icon;
				});
			}
		};

		var simTime = 0;
		var maxSimTime = simulationData.length - 1;
		document.getElementById('back').addEventListener('click', function (e) {
			simTime--;
			if (simTime < 0) {
				simTime = 0;
			}
			renderAtTime(simTime);
		});
		document.getElementById('forward').addEventListener('click', function (e) {
			simTime++;
			if (simTime > maxSimTime) {
				simTime = maxSimTime;
			}
			renderAtTime(simTime);
		});

		var slider = document.getElementById('time');
		slider.step = 1;
		slider.min = 0;
		slider.max = simulationData.length - 1;
		slider.value = 0;
		renderAtTime(0);
		slider.addEventListener('input', function (e) {
			var val = parseInt(e.target.value);
			renderAtTime(val);
			simTime = val;
		});

		var itv = void 0;
		atlas.setHotKey('p', function (e) {
			if (itv) {
				vex.dialog.confirm({
					message: 'Stop simulation?',
					callback: function callback(yes) {
						if (yes) {
							clearInterval(itv);
							itv = false;
						}
					}
				});
			} else {
				vex.dialog.prompt({
					message: 'Select simulation speed (ms/step):',
					value: 250,
					callback: function callback(step) {
						if (step) {
							var t = 0;
							itv = setInterval(function () {
								renderAtTime(t);
								t++;
								if (t > maxSimTime) {
									clearInterval(itv);
									itv = false;
								}
							}, step);
						}
					}
				});
			}
		});
	};

	var shortcutsList = document.getElementById('shortcuts-list');
	document.getElementById('shortcuts').addEventListener('click', function (e) {
		var displayList = document.createElement('div');
		displayList.innerHTML = shortcutsList.innerHTML;
		vex.dialog.alert({
			unsafeMessage: displayList.outerHTML
		});
	});

	vex.dialog.prompt({
		message: 'Enter a key to load a map:',
		callback: function callback(value) {
			if (value) {
				var loaded = atlas.loadMarkers(value);
				if (loaded) {
					loaded.forEach(function (coord) {
						coord.map = map;
						atlas.addViewMarker({
							map: map,
							coord: coord
						});
						var first = atlas.markers[0];
						if (first) {
							map.setCenter({
								lat: first.data.lat,
								lng: first.data.lng
							});
						}
					});
					var simString = localStorage.getItem('data-' + value);
					if (simString) {
						renderSimulationFromString(simString);
						vex.dialog.alert('Loaded existing simulation on map: ' + value);
					} else {
						vex.dialog.alert('Loaded existing map: ' + value);
					}
				} else {
					vex.dialog.alert('Map not found: ' + value);
				}
				window.MAP_TAG = value;
			}
		}
	});

	atlas.setHotKey('t', function (e) {
		vex.dialog.prompt({
			message: 'Enter map theme URL:',
			callback: function callback(value) {
				atlas.getMapStyleByURL(value).then(function (style) {
					localStorage.setItem('map-theme-tag', style.name);
					localStorage.setItem('map-theme-style', style.json);
					var tag = style.name;
					var theme = JSON.parse(style.json);
					atlas.changeMapStyle(map, tag, theme);

					vex.dialog.alert('Changed map theme to: ' + tag);
				}).catch(function (err) {
					vex.dialog.alert('Error: ' + err);
				});
			}
		});
	});

	atlas.setHotKey('v', function (e) {
		vex.dialog.prompt({
			message: 'Enter simulation data for map: ' + window.MAP_TAG,
			callback: function callback(value) {
				localStorage.setItem('data-' + window.MAP_TAG, value);
				renderSimulationFromString(value);
			}
		});
	});
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvdml6LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxJQUFJLFdBQVcsU0FBWCxRQUFXLENBQUMsR0FBRCxFQUFNLElBQU4sRUFBZTtBQUM3QixLQUFJLFFBQVEsU0FBUyxzQkFBVCxDQUFnQyxHQUFoQyxDQUFaO0FBQ0EsTUFBSSxJQUFJLElBQUksQ0FBWixFQUFlLElBQUksTUFBTSxNQUF6QixFQUFpQyxHQUFqQyxFQUFxQztBQUNwQyxNQUFJLE9BQU8sTUFBTSxDQUFOLENBQVg7QUFDQSxPQUFLLFNBQUwsR0FBaUIsSUFBakI7QUFDQTtBQUNELENBTkQ7O0FBUUEsSUFBSSxRQUFRLE9BQVo7O0FBRUEsTUFBTSxJQUFOLEdBQWEsSUFBYixDQUFrQixnQkFBUTs7QUFFekIsS0FBSSxhQUFhO0FBQ2IsUUFBTSxFQURPO0FBRWIsVUFBUSxJQUFJLE9BQU8sSUFBUCxDQUFZLE1BQWhCLENBQXVCLFNBQXZCLEVBQWtDLENBQUMsU0FBbkMsQ0FGSztBQUdiLFVBQVEsTUFBTSxpQkFBTixDQUF3QixVQUF4QjtBQUhLLEVBQWpCOztBQU1BLEtBQUksYUFBYSxTQUFTLGNBQVQsQ0FBd0IsS0FBeEIsQ0FBakI7O0FBRUEsS0FBSSxNQUFNLElBQUksT0FBTyxJQUFQLENBQVksR0FBaEIsQ0FBb0IsVUFBcEIsRUFBZ0MsVUFBaEMsQ0FBVjtBQUNBLFFBQU8sTUFBUCxHQUFnQixHQUFoQjtBQUNBLE9BQU0sTUFBTixDQUFhLEdBQWI7O0FBRUEsS0FBSSxjQUFjLGFBQWEsT0FBYixDQUFxQixlQUFyQixDQUFsQjtBQUNBLEtBQUksZ0JBQWdCLGFBQWEsT0FBYixDQUFxQixpQkFBckIsQ0FBcEI7QUFDQSxLQUFHLGVBQWUsYUFBbEIsRUFBZ0M7QUFDL0IsTUFBSSxRQUFRLEtBQUssS0FBTCxDQUFXLGFBQVgsQ0FBWjtBQUNBLFFBQU0sY0FBTixDQUFxQixHQUFyQixF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LEVBQXdDLE1BQU0sSUFBOUM7QUFDQSxTQUFJLE1BQU0sTUFBTSxJQUFoQjtBQUNBLFNBQUksUUFBUSxLQUFLLEtBQUwsQ0FBVyxNQUFNLElBQWpCLENBQVo7QUFDQSxXQUFNLGNBQU4sQ0FBcUIsR0FBckIsRUFBMEIsR0FBMUIsRUFBK0IsS0FBL0I7O0FBRUEsU0FBSSxNQUFKLENBQVcsS0FBWCxDQUFpQiwyQkFBMkIsR0FBNUM7QUFDQSxLQVJELEVBUUcsS0FSSCxDQVFTLGVBQU87QUFDZixTQUFJLE1BQUosQ0FBVyxLQUFYLENBQWlCLFlBQVksR0FBN0I7QUFDQSxLQVZEO0FBV0E7QUFkZ0IsR0FBbEI7QUFnQkEsRUFqQkQ7O0FBbUJBLE9BQU0sU0FBTixDQUFnQixHQUFoQixFQUFxQixhQUFLO0FBQ3pCLE1BQUksTUFBSixDQUFXLE1BQVgsQ0FBa0I7QUFDakIsWUFBUyxvQ0FBb0MsT0FBTyxPQURuQztBQUVqQixhQUFVLGtCQUFDLEtBQUQsRUFBVztBQUNwQixpQkFBYSxPQUFiLENBQXFCLFVBQVUsT0FBTyxPQUF0QyxFQUErQyxLQUEvQztBQUNBLCtCQUEyQixLQUEzQjtBQUNBO0FBTGdCLEdBQWxCO0FBT0EsRUFSRDtBQVVBLENBNU1EIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImxldCBmaWxsVGV4dCA9ICh0YWcsIHRleHQpID0+IHtcblx0bGV0IHNwYW5zID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSh0YWcpO1xuXHRmb3IobGV0IHMgPSAwOyBzIDwgc3BhbnMubGVuZ3RoOyBzKyspe1xuXHRcdGxldCBzcGFuID0gc3BhbnNbc107XG5cdFx0c3Bhbi5pbm5lclRleHQgPSB0ZXh0O1xuXHR9XG59XG5cbmxldCBhdGxhcyA9IEF0bGFzKCk7XG5cbmF0bGFzLmluaXQoKS50aGVuKGRvbmUgPT4ge1xuXG5cdGxldCBtYXBPcHRpb25zID0ge1xuXHQgICAgem9vbTogMTUsXG5cdCAgICBjZW50ZXI6IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoNDEuMjU5NzE2LCAtOTUuOTYwNTg4KSxcblx0ICAgIHN0eWxlczogYXRsYXMucmVtb3ZlVGhlbWVMYWJlbHMoTUFQX1NUWUxFUylcblx0fTtcblxuXHRsZXQgbWFwRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKTtcblxuXHRsZXQgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChtYXBFbGVtZW50LCBtYXBPcHRpb25zKTtcblx0d2luZG93Lm1hcFJlZiA9IG1hcDtcblx0YXRsYXMuc2V0TWFwKG1hcCk7XG5cblx0bGV0IG1hcFRoZW1lVGFnID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ21hcC10aGVtZS10YWcnKTtcblx0bGV0IG1hcFRoZW1lU3R5bGUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbWFwLXRoZW1lLXN0eWxlJyk7XG5cdGlmKG1hcFRoZW1lVGFnICYmIG1hcFRoZW1lU3R5bGUpe1xuXHRcdGxldCB0aGVtZSA9IEpTT04ucGFyc2UobWFwVGhlbWVTdHlsZSk7XG5cdFx0YXRsYXMuY2hhbmdlTWFwU3R5bGUobWFwLCBtYXBUaGVtZVRhZywgdGhlbWUpO1xuXHR9XG5cblx0bGV0IHJlbmRlclNpbXVsYXRpb25Gcm9tU3RyaW5nID0gKHZhbHVlKSA9PiB7XG5cdFx0bGV0IHNpbXVsYXRpb25EYXRhID0gW107XG5cdFx0bGV0IHBlYWtJbmZlY3Rpb24gPSAwO1xuXHRcdHZhbHVlLnNwbGl0KCclJykuZm9yRWFjaChpbkxpbmUgPT4ge1xuXHRcdFx0bGV0IGxpbmUgPSBpbkxpbmUudHJpbSgpO1xuXHRcdFx0bGV0IHBhcnRzID0gbGluZS5zcGxpdCgnOicpO1xuXHRcdFx0bGV0IHRpbWUgPSBwYXJzZUludChwYXJ0c1swXSk7XG5cdFx0XHRsZXQgbG9jYXRpb25zID0gW107XG5cdFx0XHRpZihwYXJ0c1sxXSl7XG5cdFx0XHRcdHBhcnRzWzFdLnNwbGl0KCckJykuZm9yRWFjaCh2YWwgPT4ge1xuXHRcdFx0XHRcdGxldCBkYXRhID0gdmFsLnNwbGl0KCcsJyk7XG5cdFx0XHRcdFx0bGV0IGxpZHggPSBwYXJzZUludChkYXRhWzBdKTtcblx0XHRcdFx0XHRsZXQgaW5mZWN0ZWQgPSBwYXJzZUludChkYXRhWzFdKTtcblx0XHRcdFx0XHRsb2NhdGlvbnNbbGlkeF0gPSB7XG5cdFx0XHRcdFx0XHRpZDogbGlkeCxcblx0XHRcdFx0XHRcdGluZmVjdGVkOiBpbmZlY3RlZFxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZihpbmZlY3RlZCA+IHBlYWtJbmZlY3Rpb24pe1xuXHRcdFx0XHRcdFx0cGVha0luZmVjdGlvbiA9IGluZmVjdGVkO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRzaW11bGF0aW9uRGF0YS5wdXNoKHtcblx0XHRcdFx0dGltZTogdGltZSxcblx0XHRcdFx0bG9jYXRpb25zOiBsb2NhdGlvbnNcblx0XHRcdH0pO1xuXHRcdH0pO1xuXG5cdFx0bGV0IHJlbmRlckF0VGltZSA9ICh2YWwpID0+IHtcblx0XHRcdGZpbGxUZXh0KCdmaWxsLXNpbS10aW1lJywgdmFsKTtcblx0XHRcdGxldCBkYXRhID0gc2ltdWxhdGlvbkRhdGFbdmFsXTtcblx0XHRcdGlmKGRhdGEpe1xuXHRcdFx0XHRhdGxhcy51cGRhdGVJY29ucyhhdGxhcy5tYXJrZXJzLCAoaWNvbiwgZW50cnksIGlkeCkgPT4ge1xuXHRcdFx0XHRcdGxldCBsb2NhdGlvbiA9IGRhdGEubG9jYXRpb25zW2lkeF0gfHwge307XG5cdFx0XHRcdFx0bGV0IGluZiA9IGxvY2F0aW9uLmluZmVjdGVkIHx8IDA7XG5cdFx0XHRcdFx0bGV0IHJhdGlvID0gaW5mIC8gcGVha0luZmVjdGlvbjtcblx0XHRcdFx0XHRpY29uLnNjYWxlID0gKDEuMCkgKyAoOS4wICogcmF0aW8pO1xuXHRcdFx0XHRcdGVudHJ5LmRhdGEudGltZSA9IHZhbDtcblx0XHRcdFx0XHRlbnRyeS5kYXRhLmluZmVjdGVkID0gaW5mO1xuXHRcdFx0XHRcdHJldHVybiBpY29uO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRsZXQgc2ltVGltZSA9IDA7XG5cdFx0bGV0IG1heFNpbVRpbWUgPSBzaW11bGF0aW9uRGF0YS5sZW5ndGggLSAxO1xuXHRcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYWNrJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcblx0XHRcdHNpbVRpbWUtLTtcblx0XHRcdGlmKHNpbVRpbWUgPCAwKXtcblx0XHRcdFx0c2ltVGltZSA9IDA7XG5cdFx0XHR9XG5cdFx0XHRyZW5kZXJBdFRpbWUoc2ltVGltZSk7XG5cdFx0fSk7XG5cdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvcndhcmQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuXHRcdFx0c2ltVGltZSsrO1xuXHRcdFx0aWYoc2ltVGltZSA+IG1heFNpbVRpbWUpe1xuXHRcdFx0XHRzaW1UaW1lID0gbWF4U2ltVGltZTtcblx0XHRcdH1cblx0XHRcdHJlbmRlckF0VGltZShzaW1UaW1lKTtcblx0XHR9KTtcblxuXHRcdGxldCBzbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZScpO1xuXHRcdHNsaWRlci5zdGVwID0gMTtcblx0XHRzbGlkZXIubWluID0gMDtcblx0XHRzbGlkZXIubWF4ID0gc2ltdWxhdGlvbkRhdGEubGVuZ3RoIC0gMTtcblx0XHRzbGlkZXIudmFsdWUgPSAwO1xuXHRcdHJlbmRlckF0VGltZSgwKTtcblx0XHRzbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBlID0+IHtcblx0XHRcdGxldCB2YWwgPSBwYXJzZUludChlLnRhcmdldC52YWx1ZSk7XG5cdFx0XHRyZW5kZXJBdFRpbWUodmFsKTtcblx0XHRcdHNpbVRpbWUgPSB2YWw7XG5cdFx0fSk7XG5cblx0XHRsZXQgaXR2O1xuXHRcdGF0bGFzLnNldEhvdEtleSgncCcsIGUgPT4ge1xuXHRcdFx0aWYoaXR2KXtcblx0XHRcdFx0dmV4LmRpYWxvZy5jb25maXJtKHtcblx0XHRcdFx0XHRtZXNzYWdlOiAnU3RvcCBzaW11bGF0aW9uPycsXG5cdFx0XHRcdFx0Y2FsbGJhY2s6ICh5ZXMpID0+IHtcblx0XHRcdFx0XHRcdGlmKHllcyl7XG5cdFx0XHRcdFx0XHRcdGNsZWFySW50ZXJ2YWwoaXR2KTtcblx0XHRcdFx0XHRcdFx0aXR2ID0gZmFsc2U7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdGVsc2V7XG5cdFx0XHRcdHZleC5kaWFsb2cucHJvbXB0KHtcblx0XHRcdFx0XHRtZXNzYWdlOiAnU2VsZWN0IHNpbXVsYXRpb24gc3BlZWQgKG1zL3N0ZXApOicsXG5cdFx0XHRcdFx0dmFsdWU6IDI1MCxcblx0XHRcdFx0XHRjYWxsYmFjazogKHN0ZXApID0+IHtcblx0XHRcdFx0XHRcdGlmKHN0ZXApe1xuXHRcdFx0XHRcdFx0XHRsZXQgdCA9IDA7XG5cdFx0XHRcdFx0XHRcdGl0diA9IHNldEludGVydmFsKGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRcdFx0cmVuZGVyQXRUaW1lKHQpO1xuXHRcdFx0XHRcdFx0XHRcdHQrKztcblx0XHRcdFx0XHRcdFx0XHRpZih0ID4gbWF4U2ltVGltZSl7XG5cdFx0XHRcdFx0XHRcdFx0XHRjbGVhckludGVydmFsKGl0dik7XG5cdFx0XHRcdFx0XHRcdFx0XHRpdHYgPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0sIHN0ZXApO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH1cblxuICAgIGxldCBzaG9ydGN1dHNMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3J0Y3V0cy1saXN0Jyk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3J0Y3V0cycpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XG4gICAgICAgIGxldCBkaXNwbGF5TGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgZGlzcGxheUxpc3QuaW5uZXJIVE1MID0gc2hvcnRjdXRzTGlzdC5pbm5lckhUTUw7XG4gICAgICAgIHZleC5kaWFsb2cuYWxlcnQoe1xuICAgICAgICAgICAgdW5zYWZlTWVzc2FnZTogZGlzcGxheUxpc3Qub3V0ZXJIVE1MXG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG5cdHZleC5kaWFsb2cucHJvbXB0KHtcblx0XHRtZXNzYWdlOiAnRW50ZXIgYSBrZXkgdG8gbG9hZCBhIG1hcDonLFxuXHRcdGNhbGxiYWNrOiAodmFsdWUpID0+IHtcblx0XHRcdGlmKHZhbHVlKXtcblx0XHRcdFx0bGV0IGxvYWRlZCA9IGF0bGFzLmxvYWRNYXJrZXJzKHZhbHVlKTtcblx0XHRcdFx0aWYobG9hZGVkKXtcblx0XHRcdFx0XHRsb2FkZWQuZm9yRWFjaChjb29yZCA9PiB7XG5cdFx0XHRcdFx0XHRjb29yZC5tYXAgPSBtYXA7XG5cdFx0XHRcdFx0XHRhdGxhcy5hZGRWaWV3TWFya2VyKHtcblx0XHRcdFx0XHRcdFx0bWFwOiBtYXAsXG5cdFx0XHRcdFx0XHRcdGNvb3JkOiBjb29yZFxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRsZXQgZmlyc3QgPSBhdGxhcy5tYXJrZXJzWzBdO1xuXHRcdFx0XHRcdFx0aWYoZmlyc3Qpe1xuXHRcdFx0XHRcdFx0XHRtYXAuc2V0Q2VudGVyKHtcblx0XHRcdFx0XHRcdFx0XHRsYXQ6IGZpcnN0LmRhdGEubGF0LFxuXHRcdFx0XHRcdFx0XHRcdGxuZzogZmlyc3QuZGF0YS5sbmdcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0bGV0IHNpbVN0cmluZyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkYXRhLScgKyB2YWx1ZSk7XG5cdFx0XHRcdFx0aWYoc2ltU3RyaW5nKXtcblx0XHRcdFx0XHRcdHJlbmRlclNpbXVsYXRpb25Gcm9tU3RyaW5nKHNpbVN0cmluZyk7XG5cdFx0XHRcdFx0XHR2ZXguZGlhbG9nLmFsZXJ0KCdMb2FkZWQgZXhpc3Rpbmcgc2ltdWxhdGlvbiBvbiBtYXA6ICcgKyB2YWx1ZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGVsc2V7XG5cdFx0XHRcdFx0XHR2ZXguZGlhbG9nLmFsZXJ0KCdMb2FkZWQgZXhpc3RpbmcgbWFwOiAnICsgdmFsdWUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNle1xuXHRcdFx0XHRcdHZleC5kaWFsb2cuYWxlcnQoJ01hcCBub3QgZm91bmQ6ICcgKyB2YWx1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0d2luZG93Lk1BUF9UQUcgPSB2YWx1ZTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xuXG5cdGF0bGFzLnNldEhvdEtleSgndCcsIGUgPT4ge1xuXHRcdHZleC5kaWFsb2cucHJvbXB0KHtcblx0XHRcdG1lc3NhZ2U6ICdFbnRlciBtYXAgdGhlbWUgVVJMOicsXG5cdFx0XHRjYWxsYmFjazogKHZhbHVlKSA9PiB7XG5cdFx0XHRcdGF0bGFzLmdldE1hcFN0eWxlQnlVUkwodmFsdWUpLnRoZW4oc3R5bGUgPT4ge1xuXHRcdFx0XHRcdGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdtYXAtdGhlbWUtdGFnJywgc3R5bGUubmFtZSk7XG5cdFx0XHRcdFx0bG9jYWxTdG9yYWdlLnNldEl0ZW0oJ21hcC10aGVtZS1zdHlsZScsIHN0eWxlLmpzb24pO1xuXHRcdFx0XHRcdGxldCB0YWcgPSBzdHlsZS5uYW1lO1xuXHRcdFx0XHRcdGxldCB0aGVtZSA9IEpTT04ucGFyc2Uoc3R5bGUuanNvbik7XG5cdFx0XHRcdFx0YXRsYXMuY2hhbmdlTWFwU3R5bGUobWFwLCB0YWcsIHRoZW1lKTtcblxuXHRcdFx0XHRcdHZleC5kaWFsb2cuYWxlcnQoJ0NoYW5nZWQgbWFwIHRoZW1lIHRvOiAnICsgdGFnKTtcblx0XHRcdFx0fSkuY2F0Y2goZXJyID0+IHtcblx0XHRcdFx0XHR2ZXguZGlhbG9nLmFsZXJ0KCdFcnJvcjogJyArIGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9KTtcblxuXHRhdGxhcy5zZXRIb3RLZXkoJ3YnLCBlID0+IHtcblx0XHR2ZXguZGlhbG9nLnByb21wdCh7XG5cdFx0XHRtZXNzYWdlOiAnRW50ZXIgc2ltdWxhdGlvbiBkYXRhIGZvciBtYXA6ICcgKyB3aW5kb3cuTUFQX1RBRyxcblx0XHRcdGNhbGxiYWNrOiAodmFsdWUpID0+IHtcblx0XHRcdFx0bG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2RhdGEtJyArIHdpbmRvdy5NQVBfVEFHLCB2YWx1ZSk7XG5cdFx0XHRcdHJlbmRlclNpbXVsYXRpb25Gcm9tU3RyaW5nKHZhbHVlKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fSk7XG5cbn0pOyJdfQ==
