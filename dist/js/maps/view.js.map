{"version":3,"sources":["view.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","config","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","db","firebase","initializeApp","database","params","qs","split","join","tokens","re","exec","decodeURIComponent","document","location","search","atlas","Atlas","init","then","done","mapOptions","zoom","center","google","maps","LatLng","styles","removeThemeLabels","MAP_STYLES","mapElement","getElementById","map","Map","window","mapRef","setMap","mapThemeTag","localStorage","getItem","mapThemeStyle","theme","JSON","parse","changeMapStyle","shortcutsList","addEventListener","displayList","createElement","innerHTML","vex","dialog","alert","unsafeMessage","outerHTML","ref","once","snap","val","loadMapFromData","message","catch","err","prompt","callback","value","storedMapData","setHotKey","getMapStyleByURL","style","setItem","name","json","tag","dataToStore","_ref","confirm","replace","p","set","handleSavedMapOverwrite","promise","link"],"mappings":"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","file":"../view.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nvar config = {\n\tapiKey: 'AIzaSyA9EYUXVL5WAh6Aam1qXlWyvi3b7HLcZ1U',\n\tauthDomain: 'esigamma.firebaseapp.com',\n\tdatabaseURL: 'https://esigamma.firebaseio.com',\n\tprojectId: 'esigamma',\n\tstorageBucket: 'esigamma.appspot.com',\n\tmessagingSenderId: '73416363603'\n};\nvar ESIFirebase = firebase.initializeApp(config, 'Atlas');\nvar db = ESIFirebase.database();\n\nfunction getQueryParams(qs) {\n\tqs = qs.split('+').join(' ');\n\tvar params = {},\n\t    tokens,\n\t    re = /[?&]?([^=]+)=([^&]*)/g;\n\twhile (tokens = re.exec(qs)) {\n\t\tparams[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);\n\t}\n\treturn params;\n}\n\nvar fillText = function fillText(tag, text) {\n\tvar spans = document.getElementsByClassName(tag);\n\tfor (var s = 0; s < spans.length; s++) {\n\t\tvar span = spans[s];\n\t\tspan.innerText = text;\n\t}\n};\n\nvar params = getQueryParams(document.location.search);\n\nvar atlas = Atlas();\n\natlas.init().then(function (done) {\n\n\tvar mapOptions = {\n\t\tzoom: 15,\n\t\tcenter: new google.maps.LatLng(41.259716, -95.960588),\n\t\tstyles: atlas.removeThemeLabels(MAP_STYLES)\n\t};\n\n\tvar mapElement = document.getElementById('map');\n\n\tvar map = new google.maps.Map(mapElement, mapOptions);\n\twindow.mapRef = map;\n\tatlas.setMap(map);\n\n\tvar mapThemeTag = localStorage.getItem('map-theme-tag');\n\tvar mapThemeStyle = localStorage.getItem('map-theme-style');\n\tif (mapThemeTag && mapThemeStyle) {\n\t\tvar theme = JSON.parse(mapThemeStyle);\n\t\tatlas.changeMapStyle(map, mapThemeTag, theme);\n\t}\n\n\tvar shortcutsList = document.getElementById('shortcuts-list');\n\tdocument.getElementById('shortcuts').addEventListener('click', function (e) {\n\t\tvar displayList = document.createElement('div');\n\t\tdisplayList.innerHTML = shortcutsList.innerHTML;\n\t\tvex.dialog.alert({\n\t\t\tunsafeMessage: displayList.outerHTML\n\t\t});\n\t});\n\n\tif (params.code) {\n\t\tvar ref = db.ref('atlas/saved/' + params.code);\n\t\tref.once('value', function (snap) {\n\t\t\tvar val = snap.val();\n\t\t\tif (val) {\n\t\t\t\tatlas.loadMapFromData(map, val);\n\t\t\t\tvex.dialog.alert({\n\t\t\t\t\tmessage: 'Loaded map data saved at code: ' + params.code + '.'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvex.dialog.alert({\n\t\t\t\t\tmessage: 'No map data saved with code: ' + params.code + '.'\n\t\t\t\t});\n\t\t\t}\n\t\t}).catch(function (err) {\n\t\t\tvex.dialog.alert({\n\t\t\t\tmessage: 'Something went wrong with the code: ' + params.code + ', : ' + err + '.'\n\t\t\t});\n\t\t});\n\t} else {\n\t\tvex.dialog.prompt({\n\t\t\tmessage: 'Enter map data:',\n\t\t\tcallback: function callback(value) {\n\t\t\t\tif (value) {\n\t\t\t\t\twindow.storedMapData = value;\n\t\t\t\t\tatlas.loadMapFromData(map, value);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tatlas.setHotKey('t', function (e) {\n\t\tvex.dialog.prompt({\n\t\t\tmessage: 'Enter map theme URL:',\n\t\t\tcallback: function callback(value) {\n\t\t\t\tatlas.getMapStyleByURL(value).then(function (style) {\n\t\t\t\t\tlocalStorage.setItem('map-theme-tag', style.name);\n\t\t\t\t\tlocalStorage.setItem('map-theme-style', style.json);\n\t\t\t\t\tvar tag = style.name;\n\t\t\t\t\tvar theme = JSON.parse(style.json);\n\t\t\t\t\tatlas.changeMapStyle(map, tag, theme);\n\t\t\t\t\tvex.dialog.alert('Changed map theme to: ' + tag);\n\t\t\t\t}).catch(function (err) {\n\t\t\t\t\tvex.dialog.alert('Error: ' + err);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n\n\tatlas.setHotKey('l', function (e) {\n\t\tvex.dialog.prompt({\n\t\t\tmessage: 'Enter map data:',\n\t\t\tcallback: function callback(value) {\n\t\t\t\tif (value) {\n\t\t\t\t\twindow.storedMapData = value;\n\t\t\t\t\tatlas.loadMapFromData(map, value);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\tatlas.setHotKey('s', function (e) {\n\t\tvar dataToStore = window.storedMapData;\n\t\tif (dataToStore) {\n\t\t\tvex.dialog.prompt({\n\t\t\t\tmessage: 'Choose a code to save your map with.',\n\t\t\t\tcallback: function callback(code) {\n\t\t\t\t\tif (code) {\n\t\t\t\t\t\tvar _ref = db.ref('atlas/saved/' + code);\n\t\t\t\t\t\t_ref.once('value', function (snap) {\n\t\t\t\t\t\t\tvar val = snap.val();\n\t\t\t\t\t\t\tif (val) {\n\t\t\t\t\t\t\t\tvex.dialog.confirm({\n\t\t\t\t\t\t\t\t\tmessage: 'There is already a map saved with code: ' + code + '. Do you want to replace it?',\n\t\t\t\t\t\t\t\t\tcallback: function callback(replace) {\n\t\t\t\t\t\t\t\t\t\tif (replace) {\n\t\t\t\t\t\t\t\t\t\t\tvar p = _ref.set(dataToStore);\n\t\t\t\t\t\t\t\t\t\t\thandleSavedMapOverwrite(p, code);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvar p = _ref.set(dataToStore);\n\t\t\t\t\t\t\t\thandleSavedMapOverwrite(p, code);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tvex.dialog.alert('There is no map data to save.');\n\t\t}\n\t});\n\n\tvar handleSavedMapOverwrite = function handleSavedMapOverwrite(promise, code) {\n\t\tpromise.then(function (done) {\n\t\t\tvar link = 'illinoistechesi.github.io/atlas/view?code=' + code;\n\t\t\tvex.dialog.prompt({\n\t\t\t\tmessage: 'Share your map with this link:',\n\t\t\t\tvalue: link,\n\t\t\t\tcallback: function callback() {}\n\t\t\t});\n\t\t}).catch(function (err) {\n\t\t\tvex.dialog.alert('Something went wrong: ' + err + '.');\n\t\t});\n\t};\n\n\t/*atlas.setHotKey('u', e => {\n \tvex.dialog.prompt({\n \t\tmessage: 'Enter hosted data file URL:',\n \t\tcallback: (value) => {\n \t\t\t$.get(value).then(res => {\n \t\t\t\tconsole.log(res);\n \t\t\t}).catch(err => {\n \t\t\t\tconsole.error(err);\n \t\t\t});\n \t\t\t//atlas.loadMapFromDataFile()\n \t\t}\n \t});\n });*/\n});\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvdmlldy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsSUFBSSxTQUFTO0FBQ1osU0FBUSx5Q0FESTtBQUVaLGFBQVksMEJBRkE7QUFHWixjQUFhLGlDQUhEO0FBSVosWUFBVyxVQUpDO0FBS1osZ0JBQWUsc0JBTEg7QUFNWixvQkFBbUI7QUFOUCxDQUFiO0FBUUEsSUFBSSxjQUFjLFNBQVMsYUFBVCxDQUF1QixNQUF2QixFQUErQixPQUEvQixDQUFsQjtBQUNBLElBQUksS0FBSyxZQUFZLFFBQVosRUFBVDs7QUFFQSxTQUFTLGNBQVQsQ0FBd0IsRUFBeEIsRUFBNEI7QUFDM0IsTUFBSyxHQUFHLEtBQUgsQ0FBUyxHQUFULEVBQWMsSUFBZCxDQUFtQixHQUFuQixDQUFMO0FBQ0EsS0FBSSxTQUFTLEVBQWI7QUFBQSxLQUNDLE1BREQ7QUFBQSxLQUVDLEtBQUssdUJBRk47QUFHQSxRQUFPLFNBQVMsR0FBRyxJQUFILENBQVEsRUFBUixDQUFoQixFQUE2QjtBQUM1QixTQUFPLG1CQUFtQixPQUFPLENBQVAsQ0FBbkIsQ0FBUCxJQUF3QyxtQkFBbUIsT0FBTyxDQUFQLENBQW5CLENBQXhDO0FBQ0E7QUFDRCxRQUFPLE1BQVA7QUFDQTs7QUFFRCxJQUFJLFdBQVcsU0FBWCxRQUFXLENBQUMsR0FBRCxFQUFNLElBQU4sRUFBZTtBQUM3QixLQUFJLFFBQVEsU0FBUyxzQkFBVCxDQUFnQyxHQUFoQyxDQUFaO0FBQ0EsTUFBSSxJQUFJLElBQUksQ0FBWixFQUFlLElBQUksTUFBTSxNQUF6QixFQUFpQyxHQUFqQyxFQUFxQztBQUNwQyxNQUFJLE9BQU8sTUFBTSxDQUFOLENBQVg7QUFDQSxPQUFLLFNBQUwsR0FBaUIsSUFBakI7QUFDQTtBQUNELENBTkQ7O0FBUUEsSUFBSSxTQUFTLGVBQWUsU0FBUyxRQUFULENBQWtCLE1BQWpDLENBQWI7O0FBRUEsSUFBSSxR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LE9BQUgsRUFBVztBQUNWLGVBQUksSUFBSSxLQUFJLEdBQUosQ0FBUSxXQUFSLENBQVI7QUFDQSxtQ0FBd0IsQ0FBeEIsRUFBMkIsSUFBM0I7QUFDQTtBQUNEO0FBUGlCLFNBQW5CO0FBU0EsUUFWRCxNQVdJO0FBQ0gsWUFBSSxJQUFJLEtBQUksR0FBSixDQUFRLFdBQVIsQ0FBUjtBQUNBLGdDQUF3QixDQUF4QixFQUEyQixJQUEzQjtBQUNBO0FBQ0QsT0FqQkQ7QUFrQkE7QUFDRDtBQXhCZ0IsSUFBbEI7QUEwQkEsR0EzQkQsTUE0Qkk7QUFDSCxPQUFJLE1BQUosQ0FBVyxLQUFYLENBQWlCLCtCQUFqQjtBQUNBO0FBQ0QsRUFqQ0Q7O0FBbUNBLEtBQUksMEJBQTBCLFNBQTFCLHVCQUEwQixDQUFDLE9BQUQsRUFBVSxJQUFWLEVBQW1CO0FBQ2hELFVBQVEsSUFBUixDQUFhLGdCQUFRO0FBQ3BCLE9BQUksc0RBQW9ELElBQXhEO0FBQ0EsT0FBSSxNQUFKLENBQVcsTUFBWCxDQUFrQjtBQUNqQiw2Q0FEaUI7QUFFakIsV0FBTyxJQUZVO0FBR2pCLGNBQVUsb0JBQU0sQ0FBRTtBQUhELElBQWxCO0FBS0EsR0FQRCxFQU9HLEtBUEgsQ0FPUyxlQUFPO0FBQ2YsT0FBSSxNQUFKLENBQVcsS0FBWCw0QkFBMEMsR0FBMUM7QUFDQSxHQVREO0FBVUEsRUFYRDs7QUFhQTs7Ozs7Ozs7Ozs7OztBQWNBLENBM0pEIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImxldCBjb25maWcgPSB7XG5cdGFwaUtleTogJ0FJemFTeUE5RVlVWFZMNVdBaDZBYW0xcVhsV3l2aTNiN0hMY1oxVScsXG5cdGF1dGhEb21haW46ICdlc2lnYW1tYS5maXJlYmFzZWFwcC5jb20nLFxuXHRkYXRhYmFzZVVSTDogJ2h0dHBzOi8vZXNpZ2FtbWEuZmlyZWJhc2Vpby5jb20nLFxuXHRwcm9qZWN0SWQ6ICdlc2lnYW1tYScsXG5cdHN0b3JhZ2VCdWNrZXQ6ICdlc2lnYW1tYS5hcHBzcG90LmNvbScsXG5cdG1lc3NhZ2luZ1NlbmRlcklkOiAnNzM0MTYzNjM2MDMnXG59O1xubGV0IEVTSUZpcmViYXNlID0gZmlyZWJhc2UuaW5pdGlhbGl6ZUFwcChjb25maWcsICdBdGxhcycpO1xubGV0IGRiID0gRVNJRmlyZWJhc2UuZGF0YWJhc2UoKTtcblxuZnVuY3Rpb24gZ2V0UXVlcnlQYXJhbXMocXMpIHtcblx0cXMgPSBxcy5zcGxpdCgnKycpLmpvaW4oJyAnKTtcblx0dmFyIHBhcmFtcyA9IHt9LFxuXHRcdHRva2Vucyxcblx0XHRyZSA9IC9bPyZdPyhbXj1dKyk9KFteJl0qKS9nO1xuXHR3aGlsZSAodG9rZW5zID0gcmUuZXhlYyhxcykpIHtcblx0XHRwYXJhbXNbZGVjb2RlVVJJQ29tcG9uZW50KHRva2Vuc1sxXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KHRva2Vuc1syXSk7XG5cdH1cblx0cmV0dXJuIHBhcmFtcztcbn1cblxubGV0IGZpbGxUZXh0ID0gKHRhZywgdGV4dCkgPT4ge1xuXHRsZXQgc3BhbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKHRhZyk7XG5cdGZvcihsZXQgcyA9IDA7IHMgPCBzcGFucy5sZW5ndGg7IHMrKyl7XG5cdFx0bGV0IHNwYW4gPSBzcGFuc1tzXTtcblx0XHRzcGFuLmlubmVyVGV4dCA9IHRleHQ7XG5cdH1cbn1cblxubGV0IHBhcmFtcyA9IGdldFF1ZXJ5UGFyYW1zKGRvY3VtZW50LmxvY2F0aW9uLnNlYXJjaCk7XG5cbmxldCBhdGxhcyA9IEF0bGFzKCk7XG5cbmF0bGFzLmluaXQoKS50aGVuKGRvbmUgPT4ge1xuXG5cdGxldCBtYXBPcHRpb25zID0ge1xuXHQgICAgem9vbTogMTUsXG5cdCAgICBjZW50ZXI6IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoNDEuMjU5NzE2LCAtOTUuOTYwNTg4KSxcblx0ICAgIHN0eWxlczogYXRsYXMucmVtb3ZlVGhlbWVMYWJlbHMoTUFQX1NUWUxFUylcblx0fTtcblxuXHRsZXQgbWFwRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKTtcblxuXHRsZXQgbWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChtYXBFbGVtZW50LCBtYXBPcHRpb25zKTtcblx0d2luZG93Lm1hcFJlZiA9IG1hcDtcblx0YXRsYXMuc2V0TWFwKG1hcCk7XG5cblx0bGV0IG1hcFRoZW1lVGFnID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ21hcC10aGVtZS10YWcnKTtcblx0bGV0IG1hcFRoZW1lU3R5bGUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbWFwLXRoZW1lLXN0eWxlJyk7XG5cdGlmKG1hcFRoZW1lVGFnICYmIG1hcFRoZW1lU3R5bGUpe1xuXHRcdGxldCB0aGVtZSA9IEpTT04ucGFyc2UobWFwVGhlbWVTdHlsZSk7XG5cdFx0YXRsYXMuY2hhbmdlTWFwU3R5bGUobWFwLCBtYXBUaGVtZVRhZywgdGhlbWUpO1xuXHR9XG5cbiAgICBsZXQgc2hvcnRjdXRzTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9ydGN1dHMtbGlzdCcpO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9ydGN1dHMnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuICAgICAgICBsZXQgZGlzcGxheUxpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGRpc3BsYXlMaXN0LmlubmVySFRNTCA9IHNob3J0Y3V0c0xpc3QuaW5uZXJIVE1MO1xuICAgICAgICB2ZXguZGlhbG9nLmFsZXJ0KHtcbiAgICAgICAgICAgIHVuc2FmZU1lc3NhZ2U6IGRpc3BsYXlMaXN0Lm91dGVySFRNTFxuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGlmKHBhcmFtcy5jb2RlKXtcbiAgICBcdGxldCByZWYgPSBkYi5yZWYoJ2F0bGFzL3NhdmVkLycgKyBwYXJhbXMuY29kZSk7XG4gICAgXHRyZWYub25jZSgndmFsdWUnLCBzbmFwID0+IHtcbiAgICBcdFx0bGV0IHZhbCA9IHNuYXAudmFsKCk7XG4gICAgXHRcdGlmKHZhbCl7XG4gICAgXHRcdFx0YXRsYXMubG9hZE1hcEZyb21EYXRhKG1hcCwgdmFsKTtcbiAgICBcdFx0XHR2ZXguZGlhbG9nLmFsZXJ0KHtcblx0ICAgIFx0XHRcdG1lc3NhZ2U6IGBMb2FkZWQgbWFwIGRhdGEgc2F2ZWQgYXQgY29kZTogJHtwYXJhbXMuY29kZX0uYFxuXHQgICAgXHRcdH0pO1xuICAgIFx0XHR9XG4gICAgXHRcdGVsc2V7XG4gICAgXHRcdFx0dmV4LmRpYWxvZy5hbGVydCh7XG5cdCAgICBcdFx0XHRtZXNzYWdlOiBgTm8gbWFwIGRhdGEgc2F2ZWQgd2l0aCBjb2RlOiAke3BhcmFtcy5jb2RlfS5gXG5cdCAgICBcdFx0fSk7XG4gICAgXHRcdH1cbiAgICBcdH0pLmNhdGNoKGVyciA9PiB7XG4gICAgXHRcdHZleC5kaWFsb2cuYWxlcnQoe1xuICAgIFx0XHRcdG1lc3NhZ2U6IGBTb21ldGhpbmcgd2VudCB3cm9uZyB3aXRoIHRoZSBjb2RlOiAke3BhcmFtcy5jb2RlfSwgOiAke2Vycn0uYFxuICAgIFx0XHR9KTtcbiAgICBcdH0pO1xuICAgIH1cbiAgICBlbHNle1xuXHRcdHZleC5kaWFsb2cucHJvbXB0KHtcblx0XHRcdG1lc3NhZ2U6ICdFbnRlciBtYXAgZGF0YTonLFxuXHRcdFx0Y2FsbGJhY2s6ICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHRpZih2YWx1ZSl7XG5cdFx0XHRcdFx0d2luZG93LnN0b3JlZE1hcERhdGEgPSB2YWx1ZTtcblx0XHRcdFx0XHRhdGxhcy5sb2FkTWFwRnJvbURhdGEobWFwLCB2YWx1ZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcbiAgICB9XG5cblx0YXRsYXMuc2V0SG90S2V5KCd0JywgZSA9PiB7XG5cdFx0dmV4LmRpYWxvZy5wcm9tcHQoe1xuXHRcdFx0bWVzc2FnZTogJ0VudGVyIG1hcCB0aGVtZSBVUkw6Jyxcblx0XHRcdGNhbGxiYWNrOiAodmFsdWUpID0+IHtcblx0XHRcdFx0YXRsYXMuZ2V0TWFwU3R5bGVCeVVSTCh2YWx1ZSkudGhlbihzdHlsZSA9PiB7XG5cdFx0XHRcdFx0bG9jYWxTdG9yYWdlLnNldEl0ZW0oJ21hcC10aGVtZS10YWcnLCBzdHlsZS5uYW1lKTtcblx0XHRcdFx0XHRsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnbWFwLXRoZW1lLXN0eWxlJywgc3R5bGUuanNvbik7XG5cdFx0XHRcdFx0bGV0IHRhZyA9IHN0eWxlLm5hbWU7XG5cdFx0XHRcdFx0bGV0IHRoZW1lID0gSlNPTi5wYXJzZShzdHlsZS5qc29uKTtcblx0XHRcdFx0XHRhdGxhcy5jaGFuZ2VNYXBTdHlsZShtYXAsIHRhZywgdGhlbWUpO1xuXHRcdFx0XHRcdHZleC5kaWFsb2cuYWxlcnQoJ0NoYW5nZWQgbWFwIHRoZW1lIHRvOiAnICsgdGFnKTtcblx0XHRcdFx0fSkuY2F0Y2goZXJyID0+IHtcblx0XHRcdFx0XHR2ZXguZGlhbG9nLmFsZXJ0KCdFcnJvcjogJyArIGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9KTtcblxuXHRhdGxhcy5zZXRIb3RLZXkoJ2wnLCBlID0+IHtcblx0XHR2ZXguZGlhbG9nLnByb21wdCh7XG5cdFx0XHRtZXNzYWdlOiAnRW50ZXIgbWFwIGRhdGE6Jyxcblx0XHRcdGNhbGxiYWNrOiAodmFsdWUpID0+IHtcblx0XHRcdFx0aWYodmFsdWUpe1xuXHRcdFx0XHRcdHdpbmRvdy5zdG9yZWRNYXBEYXRhID0gdmFsdWU7XG5cdFx0XHRcdFx0YXRsYXMubG9hZE1hcEZyb21EYXRhKG1hcCwgdmFsdWUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH0pO1xuXG5cdGF0bGFzLnNldEhvdEtleSgncycsIGUgPT4ge1xuXHRcdGxldCBkYXRhVG9TdG9yZSA9IHdpbmRvdy5zdG9yZWRNYXBEYXRhO1xuXHRcdGlmKGRhdGFUb1N0b3JlKXtcblx0XHRcdHZleC5kaWFsb2cucHJvbXB0KHtcblx0XHRcdFx0bWVzc2FnZTogJ0Nob29zZSBhIGNvZGUgdG8gc2F2ZSB5b3VyIG1hcCB3aXRoLicsXG5cdFx0XHRcdGNhbGxiYWNrOiAoY29kZSkgPT4ge1xuXHRcdFx0XHRcdGlmKGNvZGUpe1xuXHRcdFx0XHRcdFx0bGV0IHJlZiA9IGRiLnJlZignYXRsYXMvc2F2ZWQvJyArIGNvZGUpO1xuXHRcdFx0XHRcdFx0cmVmLm9uY2UoJ3ZhbHVlJywgc25hcCA9PiB7XG5cdFx0XHRcdFx0XHRcdGxldCB2YWwgPSBzbmFwLnZhbCgpO1xuXHRcdFx0XHRcdFx0XHRpZih2YWwpe1xuXHRcdFx0XHRcdFx0XHRcdHZleC5kaWFsb2cuY29uZmlybSh7XG5cdFx0XHRcdFx0XHRcdFx0XHRtZXNzYWdlOiBgVGhlcmUgaXMgYWxyZWFkeSBhIG1hcCBzYXZlZCB3aXRoIGNvZGU6ICR7Y29kZX0uIERvIHlvdSB3YW50IHRvIHJlcGxhY2UgaXQ/YCxcblx0XHRcdFx0XHRcdFx0XHRcdGNhbGxiYWNrOiAocmVwbGFjZSkgPT4ge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZihyZXBsYWNlKXtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRsZXQgcCA9IHJlZi5zZXQoZGF0YVRvU3RvcmUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdGhhbmRsZVNhdmVkTWFwT3ZlcndyaXRlKHAsIGNvZGUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0ZWxzZXtcblx0XHRcdFx0XHRcdFx0XHRsZXQgcCA9IHJlZi5zZXQoZGF0YVRvU3RvcmUpO1xuXHRcdFx0XHRcdFx0XHRcdGhhbmRsZVNhdmVkTWFwT3ZlcndyaXRlKHAsIGNvZGUpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0XHRlbHNle1xuXHRcdFx0dmV4LmRpYWxvZy5hbGVydCgnVGhlcmUgaXMgbm8gbWFwIGRhdGEgdG8gc2F2ZS4nKTtcblx0XHR9XG5cdH0pO1xuXG5cdGxldCBoYW5kbGVTYXZlZE1hcE92ZXJ3cml0ZSA9IChwcm9taXNlLCBjb2RlKSA9PiB7XG5cdFx0cHJvbWlzZS50aGVuKGRvbmUgPT4ge1xuXHRcdFx0bGV0IGxpbmsgPSBgaWxsaW5vaXN0ZWNoZXNpLmdpdGh1Yi5pby9hdGxhcy92aWV3P2NvZGU9JHtjb2RlfWA7XG5cdFx0XHR2ZXguZGlhbG9nLnByb21wdCh7XG5cdFx0XHRcdG1lc3NhZ2U6IGBTaGFyZSB5b3VyIG1hcCB3aXRoIHRoaXMgbGluazpgLFxuXHRcdFx0XHR2YWx1ZTogbGluayxcblx0XHRcdFx0Y2FsbGJhY2s6ICgpID0+IHt9XG5cdFx0XHR9KTtcblx0XHR9KS5jYXRjaChlcnIgPT4ge1xuXHRcdFx0dmV4LmRpYWxvZy5hbGVydChgU29tZXRoaW5nIHdlbnQgd3Jvbmc6ICR7ZXJyfS5gKTtcblx0XHR9KTtcblx0fVxuXG5cdC8qYXRsYXMuc2V0SG90S2V5KCd1JywgZSA9PiB7XG5cdFx0dmV4LmRpYWxvZy5wcm9tcHQoe1xuXHRcdFx0bWVzc2FnZTogJ0VudGVyIGhvc3RlZCBkYXRhIGZpbGUgVVJMOicsXG5cdFx0XHRjYWxsYmFjazogKHZhbHVlKSA9PiB7XG5cdFx0XHRcdCQuZ2V0KHZhbHVlKS50aGVuKHJlcyA9PiB7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2cocmVzKTtcblx0XHRcdFx0fSkuY2F0Y2goZXJyID0+IHtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHQvL2F0bGFzLmxvYWRNYXBGcm9tRGF0YUZpbGUoKVxuXHRcdFx0fVxuXHRcdH0pO1xuXHR9KTsqL1xuXG59KTsiXX0=\n"]}