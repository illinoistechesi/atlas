{"version":3,"sources":["viz.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","fillText","tag","text","spans","document","getElementsByClassName","innerText","atlas","Atlas","init","then","done","mapOptions","zoom","center","google","maps","LatLng","styles","removeThemeLabels","MAP_STYLES","mapElement","getElementById","map","Map","window","mapRef","setMap","mapThemeTag","localStorage","getItem","mapThemeStyle","theme","JSON","parse","changeMapStyle","renderSimulationFromString","value","simulationData","peakInfection","split","forEach","inLine","parts","trim","time","parseInt","locations","val","data","lidx","infected","id","push","renderAtTime","updateIcons","markers","icon","entry","idx","inf","ratio","scale","simTime","maxSimTime","addEventListener","slider","step","min","max","target","itv","setHotKey","vex","dialog","confirm","message","callback","yes","clearInterval","prompt","setInterval","shortcutsList","displayList","createElement","innerHTML","alert","unsafeMessage","outerHTML","loaded","loadMarkers","coord","addViewMarker","first","setCenter","lat","lng","simString","MAP_TAG","getMapStyleByURL","style","setItem","name","json","catch","err"],"mappings":"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","file":"../viz.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nvar fillText = function fillText(tag, text) {\n\tvar spans = document.getElementsByClassName(tag);\n\tfor (var s = 0; s < spans.length; s++) {\n\t\tvar span = spans[s];\n\t\tspan.innerText = text;\n\t}\n};\n\nvar atlas = Atlas();\n\natlas.init().then(function (done) {\n\n\tvar mapOptions = {\n\t\tzoom: 15,\n\t\tcenter: new google.maps.LatLng(41.259716, -95.960588),\n\t\tstyles: atlas.removeThemeLabels(MAP_STYLES)\n\t};\n\n\tvar mapElement = document.getElementById('map');\n\n\tvar map = new google.maps.Map(mapElement, mapOptions);\n\twindow.mapRef = map;\n\tatlas.setMap(map);\n\n\tvar mapThemeTag = localStorage.getItem('map-theme-tag');\n\tvar mapThemeStyle = localStorage.getItem('map-theme-style');\n\tif (mapThemeTag && mapThemeStyle) {\n\t\tvar theme = JSON.parse(mapThemeStyle);\n\t\tatlas.changeMapStyle(map, mapThemeTag, theme);\n\t}\n\n\tvar renderSimulationFromString = function renderSimulationFromString(value) {\n\t\tvar simulationData = [];\n\t\tvar peakInfection = 0;\n\t\tvalue.split('%').forEach(function (inLine) {\n\t\t\tvar line = inLine.trim();\n\t\t\tvar parts = line.split(':');\n\t\t\tvar time = parseInt(parts[0]);\n\t\t\tvar locations = [];\n\t\t\tif (parts[1]) {\n\t\t\t\tparts[1].split('$').forEach(function (val) {\n\t\t\t\t\tvar data = val.split(',');\n\t\t\t\t\tvar lidx = parseInt(data[0]);\n\t\t\t\t\tvar infected = parseInt(data[1]);\n\t\t\t\t\tlocations[lidx] = {\n\t\t\t\t\t\tid: lidx,\n\t\t\t\t\t\tinfected: infected\n\t\t\t\t\t};\n\t\t\t\t\tif (infected > peakInfection) {\n\t\t\t\t\t\tpeakInfection = infected;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tsimulationData.push({\n\t\t\t\ttime: time,\n\t\t\t\tlocations: locations\n\t\t\t});\n\t\t});\n\n\t\tvar renderAtTime = function renderAtTime(val) {\n\t\t\tfillText('fill-sim-time', val);\n\t\t\tvar data = simulationData[val];\n\t\t\tif (data) {\n\t\t\t\tatlas.updateIcons(atlas.markers, function (icon, entry, idx) {\n\t\t\t\t\tvar location = data.locations[idx] || {};\n\t\t\t\t\tvar inf = location.infected || 0;\n\t\t\t\t\tvar ratio = inf / peakInfection;\n\t\t\t\t\ticon.scale = 1.0 + 9.0 * ratio;\n\t\t\t\t\tentry.data.time = val;\n\t\t\t\t\tentry.data.infected = inf;\n\t\t\t\t\treturn icon;\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tvar simTime = 0;\n\t\tvar maxSimTime = simulationData.length - 1;\n\t\tdocument.getElementById('back').addEventListener('click', function (e) {\n\t\t\tsimTime--;\n\t\t\tif (simTime < 0) {\n\t\t\t\tsimTime = 0;\n\t\t\t}\n\t\t\trenderAtTime(simTime);\n\t\t});\n\t\tdocument.getElementById('forward').addEventListener('click', function (e) {\n\t\t\tsimTime++;\n\t\t\tif (simTime > maxSimTime) {\n\t\t\t\tsimTime = maxSimTime;\n\t\t\t}\n\t\t\trenderAtTime(simTime);\n\t\t});\n\n\t\tvar slider = document.getElementById('time');\n\t\tslider.step = 1;\n\t\tslider.min = 0;\n\t\tslider.max = simulationData.length - 1;\n\t\tslider.value = 0;\n\t\trenderAtTime(0);\n\t\tslider.addEventListener('input', function (e) {\n\t\t\tvar val = parseInt(e.target.value);\n\t\t\trenderAtTime(val);\n\t\t\tsimTime = val;\n\t\t});\n\n\t\tvar itv = void 0;\n\t\tatlas.setHotKey('p', function (e) {\n\t\t\tif (itv) {\n\t\t\t\tvex.dialog.confirm({\n\t\t\t\t\tmessage: 'Stop simulation?',\n\t\t\t\t\tcallback: function callback(yes) {\n\t\t\t\t\t\tif (yes) {\n\t\t\t\t\t\t\tclearInterval(itv);\n\t\t\t\t\t\t\titv = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvex.dialog.prompt({\n\t\t\t\t\tmessage: 'Select simulation speed (ms/step):',\n\t\t\t\t\tvalue: 250,\n\t\t\t\t\tcallback: function callback(step) {\n\t\t\t\t\t\tif (step) {\n\t\t\t\t\t\t\tvar t = 0;\n\t\t\t\t\t\t\titv = setInterval(function () {\n\t\t\t\t\t\t\t\trenderAtTime(t);\n\t\t\t\t\t\t\t\tt++;\n\t\t\t\t\t\t\t\tif (t > maxSimTime) {\n\t\t\t\t\t\t\t\t\tclearInterval(itv);\n\t\t\t\t\t\t\t\t\titv = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, step);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\tvar shortcutsList = document.getElementById('shortcuts-list');\n\tdocument.getElementById('shortcuts').addEventListener('click', function (e) {\n\t\tvar displayList = document.createElement('div');\n\t\tdisplayList.innerHTML = shortcutsList.innerHTML;\n\t\tvex.dialog.alert({\n\t\t\tunsafeMessage: displayList.outerHTML\n\t\t});\n\t});\n\n\tvex.dialog.prompt({\n\t\tmessage: 'Enter a key to load a map:',\n\t\tcallback: function callback(value) {\n\t\t\tif (value) {\n\t\t\t\tvar loaded = atlas.loadMarkers(value);\n\t\t\t\tif (loaded) {\n\t\t\t\t\tloaded.forEach(function (coord) {\n\t\t\t\t\t\tcoord.map = map;\n\t\t\t\t\t\tatlas.addViewMarker({\n\t\t\t\t\t\t\tmap: map,\n\t\t\t\t\t\t\tcoord: coord\n\t\t\t\t\t\t});\n\t\t\t\t\t\tvar first = atlas.markers[0];\n\t\t\t\t\t\tif (first) {\n\t\t\t\t\t\t\tmap.setCenter({\n\t\t\t\t\t\t\t\tlat: first.data.lat,\n\t\t\t\t\t\t\t\tlng: first.data.lng\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tvar simString = localStorage.getItem('data-' + value);\n\t\t\t\t\tif (simString) {\n\t\t\t\t\t\trenderSimulationFromString(simString);\n\t\t\t\t\t\tvex.dialog.alert('Loaded existing simulation on map: ' + value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvex.dialog.alert('Loaded existing map: ' + value);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvex.dialog.alert('Map not found: ' + value);\n\t\t\t\t}\n\t\t\t\twindow.MAP_TAG = value;\n\t\t\t}\n\t\t}\n\t});\n\n\tatlas.setHotKey('t', function (e) {\n\t\tvex.dialog.prompt({\n\t\t\tmessage: 'Enter map theme URL:',\n\t\t\tcallback: function callback(value) {\n\t\t\t\tatlas.getMapStyleByURL(value).then(function (style) {\n\t\t\t\t\tlocalStorage.setItem('map-theme-tag', style.name);\n\t\t\t\t\tlocalStorage.setItem('map-theme-style', style.json);\n\t\t\t\t\tvar tag = style.name;\n\t\t\t\t\tvar theme = JSON.parse(style.json);\n\t\t\t\t\tatlas.changeMapStyle(map, tag, theme);\n\t\t\t\t\tvex.dialog.alert('Changed map theme to: ' + tag);\n\t\t\t\t}).catch(function (err) {\n\t\t\t\t\tvex.dialog.alert('Error: ' + err);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n\n\tatlas.setHotKey('v', function (e) {\n\t\tvex.dialog.prompt({\n\t\t\tmessage: 'Enter simulation data for map: ' + window.MAP_TAG,\n\t\t\tcallback: function callback(value) {\n\t\t\t\tlocalStorage.setItem('data-' + window.MAP_TAG, value);\n\t\t\t\trenderSimulationFromString(value);\n\t\t\t}\n\t\t});\n\t});\n});\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvdml6LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxJQUFJLFdBQVcsU0FBWCxRQUFXLENBQUMsR0FBRCxFQUFNLElBQU4sRUFBZTtBQUM3QixLQUFJLFFBQVEsU0FBUyxzQkFBVCxDQUFnQyxHQUFoQyxDQUFaO0FBQ0EsTUFBSSxJQUFJLElBQUksQ0FBWixFQUFlLElBQUksTUFBTSxNQUF6QixFQUFpQyxHQUFqQyxFQUFxQztBQUNwQyxNQUFJLE9BQU8sTUFBTSxDQUFOLENBQVg7QUFDQSxPQUFLLFNBQUwsR0FBaUIsSUFBakI7QUFDQTtBQUNELENBTkQ7O0FBUUEsSUFBSSxRQUFRLE9BQVo7O0FBRUEsTUFBTSxJQUFOLEdBQWEsSUFBYixDQUFrQixnQkFBUTs7QUFFekIsS0FBSSxhQUFhO0FBQ2IsUUFBTSxFQURPO0FBRWIsVUFBUSxJQUFJLE9BQU8sSUFBUCxDQUFZLE1BQWhCLENBQXVCLFNBQXZCLEVBQWtDLENBQUMsU0FBbkMsQ0FGSztBQUdiLFVBQVEsTUFBTSxpQkFBTixDQUF3QixVQUF4QjtBQUhLLEVBQWpCOztBQU1BLEtBQUksYUFBYSxTQUFTLGNBQVQsQ0FBd0IsS0FBeEIsQ0FBakI7O0FBRUEsS0FBSSxNQUFNLElBQUksT0FBTyxJQUFQLENBQVksR0FBaEIsQ0FBb0IsVUFBcEIsRUFBZ0MsVUFBaEMsQ0FBVjtBQUNBLFFBQU8sTUFBUCxHQUFnQixHQUFoQjtBQUNBLE9BQU0sTUFBTixDQUFhLEdBQWI7O0FBRUEsS0FBSSxjQUFjLGFBQWEsT0FBYixDQUFxQixlQUFyQixDQUFsQjtBQUNBLEtBQUksZ0JBQWdCLGFBQWEsT0FBYixDQUFxQixpQkFBckIsQ0FBcEI7QUFDQSxLQUFHLGVBQWUsYUFBbEIsRUFBZ0M7QUFDL0IsTUFBSSxRQUFRLEtBQUssS0FBTCxDQUFXLGFBQVgsQ0FBWjtBQUNBLFFBQU0sY0FBTixDQUFxQixHQUFyQixF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LEVBQXdDLE1BQU0sSUFBOUM7QUFDQSxTQUFJLE1BQU0sTUFBTSxJQUFoQjtBQUNBLFNBQUksUUFBUSxLQUFLLEtBQUwsQ0FBVyxNQUFNLElBQWpCLENBQVo7QUFDQSxXQUFNLGNBQU4sQ0FBcUIsR0FBckIsRUFBMEIsR0FBMUIsRUFBK0IsS0FBL0I7QUFDQSxTQUFJLE1BQUosQ0FBVyxLQUFYLENBQWlCLDJCQUEyQixHQUE1QztBQUNBLEtBUEQsRUFPRyxLQVBILENBT1MsZUFBTztBQUNmLFNBQUksTUFBSixDQUFXLEtBQVgsQ0FBaUIsWUFBWSxHQUE3QjtBQUNBLEtBVEQ7QUFVQTtBQWJnQixHQUFsQjtBQWVBLEVBaEJEOztBQWtCQSxPQUFNLFNBQU4sQ0FBZ0IsR0FBaEIsRUFBcUIsYUFBSztBQUN6QixNQUFJLE1BQUosQ0FBVyxNQUFYLENBQWtCO0FBQ2pCLFlBQVMsb0NBQW9DLE9BQU8sT0FEbkM7QUFFakIsYUFBVSxrQkFBQyxLQUFELEVBQVc7QUFDcEIsaUJBQWEsT0FBYixDQUFxQixVQUFVLE9BQU8sT0FBdEMsRUFBK0MsS0FBL0M7QUFDQSwrQkFBMkIsS0FBM0I7QUFDQTtBQUxnQixHQUFsQjtBQU9BLEVBUkQ7QUFVQSxDQTNNRCIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJsZXQgZmlsbFRleHQgPSAodGFnLCB0ZXh0KSA9PiB7XG5cdGxldCBzcGFucyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUodGFnKTtcblx0Zm9yKGxldCBzID0gMDsgcyA8IHNwYW5zLmxlbmd0aDsgcysrKXtcblx0XHRsZXQgc3BhbiA9IHNwYW5zW3NdO1xuXHRcdHNwYW4uaW5uZXJUZXh0ID0gdGV4dDtcblx0fVxufVxuXG5sZXQgYXRsYXMgPSBBdGxhcygpO1xuXG5hdGxhcy5pbml0KCkudGhlbihkb25lID0+IHtcblxuXHRsZXQgbWFwT3B0aW9ucyA9IHtcblx0ICAgIHpvb206IDE1LFxuXHQgICAgY2VudGVyOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKDQxLjI1OTcxNiwgLTk1Ljk2MDU4OCksXG5cdCAgICBzdHlsZXM6IGF0bGFzLnJlbW92ZVRoZW1lTGFiZWxzKE1BUF9TVFlMRVMpXG5cdH07XG5cblx0bGV0IG1hcEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyk7XG5cblx0bGV0IG1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAobWFwRWxlbWVudCwgbWFwT3B0aW9ucyk7XG5cdHdpbmRvdy5tYXBSZWYgPSBtYXA7XG5cdGF0bGFzLnNldE1hcChtYXApO1xuXG5cdGxldCBtYXBUaGVtZVRhZyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdtYXAtdGhlbWUtdGFnJyk7XG5cdGxldCBtYXBUaGVtZVN0eWxlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ21hcC10aGVtZS1zdHlsZScpO1xuXHRpZihtYXBUaGVtZVRhZyAmJiBtYXBUaGVtZVN0eWxlKXtcblx0XHRsZXQgdGhlbWUgPSBKU09OLnBhcnNlKG1hcFRoZW1lU3R5bGUpO1xuXHRcdGF0bGFzLmNoYW5nZU1hcFN0eWxlKG1hcCwgbWFwVGhlbWVUYWcsIHRoZW1lKTtcblx0fVxuXG5cdGxldCByZW5kZXJTaW11bGF0aW9uRnJvbVN0cmluZyA9ICh2YWx1ZSkgPT4ge1xuXHRcdGxldCBzaW11bGF0aW9uRGF0YSA9IFtdO1xuXHRcdGxldCBwZWFrSW5mZWN0aW9uID0gMDtcblx0XHR2YWx1ZS5zcGxpdCgnJScpLmZvckVhY2goaW5MaW5lID0+IHtcblx0XHRcdGxldCBsaW5lID0gaW5MaW5lLnRyaW0oKTtcblx0XHRcdGxldCBwYXJ0cyA9IGxpbmUuc3BsaXQoJzonKTtcblx0XHRcdGxldCB0aW1lID0gcGFyc2VJbnQocGFydHNbMF0pO1xuXHRcdFx0bGV0IGxvY2F0aW9ucyA9IFtdO1xuXHRcdFx0aWYocGFydHNbMV0pe1xuXHRcdFx0XHRwYXJ0c1sxXS5zcGxpdCgnJCcpLmZvckVhY2godmFsID0+IHtcblx0XHRcdFx0XHRsZXQgZGF0YSA9IHZhbC5zcGxpdCgnLCcpO1xuXHRcdFx0XHRcdGxldCBsaWR4ID0gcGFyc2VJbnQoZGF0YVswXSk7XG5cdFx0XHRcdFx0bGV0IGluZmVjdGVkID0gcGFyc2VJbnQoZGF0YVsxXSk7XG5cdFx0XHRcdFx0bG9jYXRpb25zW2xpZHhdID0ge1xuXHRcdFx0XHRcdFx0aWQ6IGxpZHgsXG5cdFx0XHRcdFx0XHRpbmZlY3RlZDogaW5mZWN0ZWRcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYoaW5mZWN0ZWQgPiBwZWFrSW5mZWN0aW9uKXtcblx0XHRcdFx0XHRcdHBlYWtJbmZlY3Rpb24gPSBpbmZlY3RlZDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0c2ltdWxhdGlvbkRhdGEucHVzaCh7XG5cdFx0XHRcdHRpbWU6IHRpbWUsXG5cdFx0XHRcdGxvY2F0aW9uczogbG9jYXRpb25zXG5cdFx0XHR9KTtcblx0XHR9KTtcblxuXHRcdGxldCByZW5kZXJBdFRpbWUgPSAodmFsKSA9PiB7XG5cdFx0XHRmaWxsVGV4dCgnZmlsbC1zaW0tdGltZScsIHZhbCk7XG5cdFx0XHRsZXQgZGF0YSA9IHNpbXVsYXRpb25EYXRhW3ZhbF07XG5cdFx0XHRpZihkYXRhKXtcblx0XHRcdFx0YXRsYXMudXBkYXRlSWNvbnMoYXRsYXMubWFya2VycywgKGljb24sIGVudHJ5LCBpZHgpID0+IHtcblx0XHRcdFx0XHRsZXQgbG9jYXRpb24gPSBkYXRhLmxvY2F0aW9uc1tpZHhdIHx8IHt9O1xuXHRcdFx0XHRcdGxldCBpbmYgPSBsb2NhdGlvbi5pbmZlY3RlZCB8fCAwO1xuXHRcdFx0XHRcdGxldCByYXRpbyA9IGluZiAvIHBlYWtJbmZlY3Rpb247XG5cdFx0XHRcdFx0aWNvbi5zY2FsZSA9ICgxLjApICsgKDkuMCAqIHJhdGlvKTtcblx0XHRcdFx0XHRlbnRyeS5kYXRhLnRpbWUgPSB2YWw7XG5cdFx0XHRcdFx0ZW50cnkuZGF0YS5pbmZlY3RlZCA9IGluZjtcblx0XHRcdFx0XHRyZXR1cm4gaWNvbjtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0bGV0IHNpbVRpbWUgPSAwO1xuXHRcdGxldCBtYXhTaW1UaW1lID0gc2ltdWxhdGlvbkRhdGEubGVuZ3RoIC0gMTtcblx0XHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmFjaycpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XG5cdFx0XHRzaW1UaW1lLS07XG5cdFx0XHRpZihzaW1UaW1lIDwgMCl7XG5cdFx0XHRcdHNpbVRpbWUgPSAwO1xuXHRcdFx0fVxuXHRcdFx0cmVuZGVyQXRUaW1lKHNpbVRpbWUpO1xuXHRcdH0pO1xuXHRcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb3J3YXJkJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcblx0XHRcdHNpbVRpbWUrKztcblx0XHRcdGlmKHNpbVRpbWUgPiBtYXhTaW1UaW1lKXtcblx0XHRcdFx0c2ltVGltZSA9IG1heFNpbVRpbWU7XG5cdFx0XHR9XG5cdFx0XHRyZW5kZXJBdFRpbWUoc2ltVGltZSk7XG5cdFx0fSk7XG5cblx0XHRsZXQgc2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWUnKTtcblx0XHRzbGlkZXIuc3RlcCA9IDE7XG5cdFx0c2xpZGVyLm1pbiA9IDA7XG5cdFx0c2xpZGVyLm1heCA9IHNpbXVsYXRpb25EYXRhLmxlbmd0aCAtIDE7XG5cdFx0c2xpZGVyLnZhbHVlID0gMDtcblx0XHRyZW5kZXJBdFRpbWUoMCk7XG5cdFx0c2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgZSA9PiB7XG5cdFx0XHRsZXQgdmFsID0gcGFyc2VJbnQoZS50YXJnZXQudmFsdWUpO1xuXHRcdFx0cmVuZGVyQXRUaW1lKHZhbCk7XG5cdFx0XHRzaW1UaW1lID0gdmFsO1xuXHRcdH0pO1xuXG5cdFx0bGV0IGl0djtcblx0XHRhdGxhcy5zZXRIb3RLZXkoJ3AnLCBlID0+IHtcblx0XHRcdGlmKGl0dil7XG5cdFx0XHRcdHZleC5kaWFsb2cuY29uZmlybSh7XG5cdFx0XHRcdFx0bWVzc2FnZTogJ1N0b3Agc2ltdWxhdGlvbj8nLFxuXHRcdFx0XHRcdGNhbGxiYWNrOiAoeWVzKSA9PiB7XG5cdFx0XHRcdFx0XHRpZih5ZXMpe1xuXHRcdFx0XHRcdFx0XHRjbGVhckludGVydmFsKGl0dik7XG5cdFx0XHRcdFx0XHRcdGl0diA9IGZhbHNlO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRlbHNle1xuXHRcdFx0XHR2ZXguZGlhbG9nLnByb21wdCh7XG5cdFx0XHRcdFx0bWVzc2FnZTogJ1NlbGVjdCBzaW11bGF0aW9uIHNwZWVkIChtcy9zdGVwKTonLFxuXHRcdFx0XHRcdHZhbHVlOiAyNTAsXG5cdFx0XHRcdFx0Y2FsbGJhY2s6IChzdGVwKSA9PiB7XG5cdFx0XHRcdFx0XHRpZihzdGVwKXtcblx0XHRcdFx0XHRcdFx0bGV0IHQgPSAwO1xuXHRcdFx0XHRcdFx0XHRpdHYgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0XHRcdHJlbmRlckF0VGltZSh0KTtcblx0XHRcdFx0XHRcdFx0XHR0Kys7XG5cdFx0XHRcdFx0XHRcdFx0aWYodCA+IG1heFNpbVRpbWUpe1xuXHRcdFx0XHRcdFx0XHRcdFx0Y2xlYXJJbnRlcnZhbChpdHYpO1xuXHRcdFx0XHRcdFx0XHRcdFx0aXR2ID0gZmFsc2U7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9LCBzdGVwKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cbiAgICBsZXQgc2hvcnRjdXRzTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9ydGN1dHMtbGlzdCcpO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9ydGN1dHMnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuICAgICAgICBsZXQgZGlzcGxheUxpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIGRpc3BsYXlMaXN0LmlubmVySFRNTCA9IHNob3J0Y3V0c0xpc3QuaW5uZXJIVE1MO1xuICAgICAgICB2ZXguZGlhbG9nLmFsZXJ0KHtcbiAgICAgICAgICAgIHVuc2FmZU1lc3NhZ2U6IGRpc3BsYXlMaXN0Lm91dGVySFRNTFxuICAgICAgICB9KTtcbiAgICB9KTtcblxuXHR2ZXguZGlhbG9nLnByb21wdCh7XG5cdFx0bWVzc2FnZTogJ0VudGVyIGEga2V5IHRvIGxvYWQgYSBtYXA6Jyxcblx0XHRjYWxsYmFjazogKHZhbHVlKSA9PiB7XG5cdFx0XHRpZih2YWx1ZSl7XG5cdFx0XHRcdGxldCBsb2FkZWQgPSBhdGxhcy5sb2FkTWFya2Vycyh2YWx1ZSk7XG5cdFx0XHRcdGlmKGxvYWRlZCl7XG5cdFx0XHRcdFx0bG9hZGVkLmZvckVhY2goY29vcmQgPT4ge1xuXHRcdFx0XHRcdFx0Y29vcmQubWFwID0gbWFwO1xuXHRcdFx0XHRcdFx0YXRsYXMuYWRkVmlld01hcmtlcih7XG5cdFx0XHRcdFx0XHRcdG1hcDogbWFwLFxuXHRcdFx0XHRcdFx0XHRjb29yZDogY29vcmRcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0bGV0IGZpcnN0ID0gYXRsYXMubWFya2Vyc1swXTtcblx0XHRcdFx0XHRcdGlmKGZpcnN0KXtcblx0XHRcdFx0XHRcdFx0bWFwLnNldENlbnRlcih7XG5cdFx0XHRcdFx0XHRcdFx0bGF0OiBmaXJzdC5kYXRhLmxhdCxcblx0XHRcdFx0XHRcdFx0XHRsbmc6IGZpcnN0LmRhdGEubG5nXG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGxldCBzaW1TdHJpbmcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZGF0YS0nICsgdmFsdWUpO1xuXHRcdFx0XHRcdGlmKHNpbVN0cmluZyl7XG5cdFx0XHRcdFx0XHRyZW5kZXJTaW11bGF0aW9uRnJvbVN0cmluZyhzaW1TdHJpbmcpO1xuXHRcdFx0XHRcdFx0dmV4LmRpYWxvZy5hbGVydCgnTG9hZGVkIGV4aXN0aW5nIHNpbXVsYXRpb24gb24gbWFwOiAnICsgdmFsdWUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRlbHNle1xuXHRcdFx0XHRcdFx0dmV4LmRpYWxvZy5hbGVydCgnTG9hZGVkIGV4aXN0aW5nIG1hcDogJyArIHZhbHVlKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0ZWxzZXtcblx0XHRcdFx0XHR2ZXguZGlhbG9nLmFsZXJ0KCdNYXAgbm90IGZvdW5kOiAnICsgdmFsdWUpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHdpbmRvdy5NQVBfVEFHID0gdmFsdWU7XG5cdFx0XHR9XG5cdFx0fVxuXHR9KTtcblxuXHRhdGxhcy5zZXRIb3RLZXkoJ3QnLCBlID0+IHtcblx0XHR2ZXguZGlhbG9nLnByb21wdCh7XG5cdFx0XHRtZXNzYWdlOiAnRW50ZXIgbWFwIHRoZW1lIFVSTDonLFxuXHRcdFx0Y2FsbGJhY2s6ICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHRhdGxhcy5nZXRNYXBTdHlsZUJ5VVJMKHZhbHVlKS50aGVuKHN0eWxlID0+IHtcblx0XHRcdFx0XHRsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnbWFwLXRoZW1lLXRhZycsIHN0eWxlLm5hbWUpO1xuXHRcdFx0XHRcdGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdtYXAtdGhlbWUtc3R5bGUnLCBzdHlsZS5qc29uKTtcblx0XHRcdFx0XHRsZXQgdGFnID0gc3R5bGUubmFtZTtcblx0XHRcdFx0XHRsZXQgdGhlbWUgPSBKU09OLnBhcnNlKHN0eWxlLmpzb24pO1xuXHRcdFx0XHRcdGF0bGFzLmNoYW5nZU1hcFN0eWxlKG1hcCwgdGFnLCB0aGVtZSk7XG5cdFx0XHRcdFx0dmV4LmRpYWxvZy5hbGVydCgnQ2hhbmdlZCBtYXAgdGhlbWUgdG86ICcgKyB0YWcpO1xuXHRcdFx0XHR9KS5jYXRjaChlcnIgPT4ge1xuXHRcdFx0XHRcdHZleC5kaWFsb2cuYWxlcnQoJ0Vycm9yOiAnICsgZXJyKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH0pO1xuXG5cdGF0bGFzLnNldEhvdEtleSgndicsIGUgPT4ge1xuXHRcdHZleC5kaWFsb2cucHJvbXB0KHtcblx0XHRcdG1lc3NhZ2U6ICdFbnRlciBzaW11bGF0aW9uIGRhdGEgZm9yIG1hcDogJyArIHdpbmRvdy5NQVBfVEFHLFxuXHRcdFx0Y2FsbGJhY2s6ICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHRsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZGF0YS0nICsgd2luZG93Lk1BUF9UQUcsIHZhbHVlKTtcblx0XHRcdFx0cmVuZGVyU2ltdWxhdGlvbkZyb21TdHJpbmcodmFsdWUpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9KTtcblxufSk7Il19\n"]}