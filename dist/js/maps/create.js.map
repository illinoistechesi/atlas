{"version":3,"sources":["create.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","atlas","Atlas","init","then","done","mapOptions","zoom","center","google","maps","LatLng","styles","removeThemeLabels","MAP_STYLES","mapElement","document","getElementById","map","Map","window","mapRef","setMap","mapThemeTag","localStorage","getItem","mapThemeStyle","theme","JSON","parse","changeMapStyle","event","addListener","isShiftClick","coord","latLng","addDefaultMarker","lat","lng","vex","dialog","prompt","message","callback","value","loaded","loadMarkers","forEach","name","first","markers","setCenter","data","alert","MAP_TAG","importCoordinates","tag","setItem","shortcutsList","addEventListener","displayList","createElement","innerHTML","unsafeMessage","outerHTML","setHotKey","confirm","yes","markersToString","getMapStyleByURL","style","json","catch","err"],"mappings":"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","file":"../create.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nvar atlas = Atlas();\n\natlas.init().then(function (done) {\n\n    var mapOptions = {\n        zoom: 15,\n        center: new google.maps.LatLng(41.259716, -95.960588),\n        styles: atlas.removeThemeLabels(MAP_STYLES)\n    };\n\n    var mapElement = document.getElementById('map');\n\n    var map = new google.maps.Map(mapElement, mapOptions);\n    window.mapRef = map;\n    atlas.setMap(map);\n\n    var mapThemeTag = localStorage.getItem('map-theme-tag');\n    var mapThemeStyle = localStorage.getItem('map-theme-style');\n    if (mapThemeTag && mapThemeStyle) {\n        var theme = JSON.parse(mapThemeStyle);\n        atlas.changeMapStyle(map, mapThemeTag, theme);\n    }\n\n    google.maps.event.addListener(map, 'click', function (e) {\n        if (atlas.isShiftClick()) {\n            var coord = e.latLng;\n            var entry = atlas.addDefaultMarker({\n                map: map,\n                coord: {\n                    lat: coord.lat(),\n                    lng: coord.lng()\n                }\n            });\n            /*atlas.updateName(atlas.markers.length - 1).then(added => {\n                if(!added){\n                    atlas.removeMarker(atlas.markers.length - 1);\n                }\n            });*/\n        }\n    });\n\n    vex.dialog.prompt({\n        message: 'Enter a key to create or load a map:',\n        callback: function callback(value) {\n            if (value) {\n                var loaded = atlas.loadMarkers(value);\n                if (loaded) {\n                    loaded.forEach(function (coord) {\n                        coord.map = map;\n                        atlas.addDefaultMarker({\n                            map: map,\n                            coord: coord,\n                            name: coord.name\n                        });\n                        var first = atlas.markers[0];\n                        if (first) {\n                            map.setCenter({\n                                lat: first.data.lat,\n                                lng: first.data.lng\n                            });\n                        }\n                    });\n                    vex.dialog.alert('Loaded existing map: ' + value);\n                } else {\n                    vex.dialog.alert('Created new map: ' + value);\n                }\n                window.MAP_TAG = value;\n            }\n        }\n    });\n\n    var importCoordinates = function importCoordinates(tag) {\n        vex.dialog.prompt({\n            message: 'Import your coordinates:',\n            callback: function callback(value) {\n                localStorage.setItem(tag, value);\n            }\n        });\n    };\n\n    var shortcutsList = document.getElementById('shortcuts-list');\n    document.getElementById('shortcuts').addEventListener('click', function (e) {\n        var displayList = document.createElement('div');\n        displayList.innerHTML = shortcutsList.innerHTML;\n        vex.dialog.alert({\n            unsafeMessage: displayList.outerHTML\n        });\n    });\n\n    atlas.setHotKey('i', function (e) {\n        vex.dialog.prompt({\n            message: 'Enter a key for this map:',\n            callback: function callback(tag) {\n                var existing = localStorage.getItem(tag);\n                if (existing) {\n                    vex.dialog.confirm({\n                        message: 'This will overwrite an existing map, are you sure?',\n                        callback: function callback(yes) {\n                            if (yes) {\n                                importCoordinates(tag);\n                            }\n                        }\n                    });\n                } else {\n                    importCoordinates(tag);\n                }\n            }\n        });\n    });\n\n    atlas.setHotKey('e', function (e) {\n        vex.dialog.prompt({\n            message: 'Exported coordinates:',\n            value: atlas.markersToString(atlas.markers),\n            callback: function callback(value) {}\n        });\n    });\n\n    atlas.setHotKey('t', function (e) {\n        vex.dialog.prompt({\n            message: 'Enter map theme URL:',\n            callback: function callback(value) {\n                atlas.getMapStyleByURL(value).then(function (style) {\n                    localStorage.setItem('map-theme-tag', style.name);\n                    localStorage.setItem('map-theme-style', style.json);\n                    var tag = style.name;\n                    var theme = JSON.parse(style.json);\n                    atlas.changeMapStyle(map, tag, theme);\n                    vex.dialog.alert('Changed map theme to: ' + tag);\n                }).catch(function (err) {\n                    vex.dialog.alert('Error: ' + err);\n                });\n            }\n        });\n    });\n});\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvY3JlYXRlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxJQUFJLFFBQVEsT0FBWjs7QUFFQSxNQUFNLElBQU4sR0FBYSxJQUFiLENBQWtCLGdCQUFROztBQUV0QixRQUFJLGFBQWE7QUFDYixjQUFNLEVBRE87QUFFYixnQkFBUSxJQUFJLE9BQU8sSUFBUCxDQUFZLE1BQWhCLENBQXVCLFNBQXZCLEVBQWtDLENBQUMsU0FBbkMsQ0FGSztBQUdiLGdCQUFRLE1BQU0saUJBQU4sQ0FBd0IsVUFBeEI7QUFISyxLQUFqQjs7QUFNQSxRQUFJLGFBQWEsU0FBUyxjQUFULENBQXdCLEtBQXhCLENBQWpCOztBQUVBLFFBQUksTUFBTSxJQUFJLE9BQU8sSUFBUCxDQUFZLEdBQWhCLENBQW9CLFVBQXBCLEVBQWdDLFVBQWhDLENBQVY7QUFDQSxXQUFPLE1BQVAsR0FBZ0IsR0FBaEI7QUFDQSxVQUFNLE1BQU4sQ0FBYSxHQUFiOztBQUVBLFFBQUksY0FBYyxhQUFhLE9BQWIsQ0FBcUIsZUFBckIsQ0FBbEI7QUFDQSxRQUFJLGdCQUFnQixhQUFhLE9BQWIsQ0FBcUIsaUJBQXJCLENBQXBCO0FBQ0EsUUFBRyxlQUFlLGFBQWxCLEVBQWdDO0FBQzVCLFlBQUksUUFBUSxLQUFLLEtBQUwsQ0FBVyxhQUFYLENBQVo7QUFDQSxjQUFNLGNBQU4sQ0FBcUIsR0FBckIsRUFBMEIsV0FBMUIsRUFBdUMsS0FBdkM7QUFDSDs7QUFFRCxXQUFPLElBQVAsQ0FBWSxLQUFaLENBQWtCLFdBQWxCLENBQThCLEdBQTlCLEVBQW1DLE9BQW5DLEVBQTRDLGFBQUs7QUFDN0MsWUFBRyxNQUFNLFlBQU4sRUFBSCxFQUF3QjtBQUNwQixnQkFBSSxRQUFRLEVBQUUsTUFBZDtBQUNBLGdCQUFJLFFBQVEsTUFBTSxnQkFBTixDQUF1QjtBQUMvQixxQkFBSyxHQUQwQjtBQUUvQix1QkFBTztBQUNI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WCxDQUFrQjtBQUNkLHFCQUFTLHNCQURLO0FBRWQsc0JBQVUsa0JBQUMsS0FBRCxFQUFXO0FBQ2pCLHNCQUFNLGdCQUFOLENBQXVCLEtBQXZCLEVBQThCLElBQTlCLENBQW1DLGlCQUFTO0FBQ3hDLGlDQUFhLE9BQWIsQ0FBcUIsZUFBckIsRUFBc0MsTUFBTSxJQUE1QztBQUNBLGlDQUFhLE9BQWIsQ0FBcUIsaUJBQXJCLEVBQXdDLE1BQU0sSUFBOUM7QUFDQSx3QkFBSSxNQUFNLE1BQU0sSUFBaEI7QUFDQSx3QkFBSSxRQUFRLEtBQUssS0FBTCxDQUFXLE1BQU0sSUFBakIsQ0FBWjtBQUNBLDBCQUFNLGNBQU4sQ0FBcUIsR0FBckIsRUFBMEIsR0FBMUIsRUFBK0IsS0FBL0I7QUFDQSx3QkFBSSxNQUFKLENBQVcsS0FBWCxDQUFpQiwyQkFBMkIsR0FBNUM7QUFDSCxpQkFQRCxFQU9HLEtBUEgsQ0FPUyxlQUFPO0FBQ1osd0JBQUksTUFBSixDQUFXLEtBQVgsQ0FBaUIsWUFBWSxHQUE3QjtBQUNILGlCQVREO0FBVUg7QUFiYSxTQUFsQjtBQWVILEtBaEJEO0FBa0JILENBeElEIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImxldCBhdGxhcyA9IEF0bGFzKCk7XG5cbmF0bGFzLmluaXQoKS50aGVuKGRvbmUgPT4ge1xuXG4gICAgbGV0IG1hcE9wdGlvbnMgPSB7XG4gICAgICAgIHpvb206IDE1LFxuICAgICAgICBjZW50ZXI6IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoNDEuMjU5NzE2LCAtOTUuOTYwNTg4KSxcbiAgICAgICAgc3R5bGVzOiBhdGxhcy5yZW1vdmVUaGVtZUxhYmVscyhNQVBfU1RZTEVTKVxuICAgIH07XG5cbiAgICBsZXQgbWFwRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKTtcblxuICAgIGxldCBtYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKG1hcEVsZW1lbnQsIG1hcE9wdGlvbnMpO1xuICAgIHdpbmRvdy5tYXBSZWYgPSBtYXA7XG4gICAgYXRsYXMuc2V0TWFwKG1hcCk7XG5cbiAgICBsZXQgbWFwVGhlbWVUYWcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbWFwLXRoZW1lLXRhZycpO1xuICAgIGxldCBtYXBUaGVtZVN0eWxlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ21hcC10aGVtZS1zdHlsZScpO1xuICAgIGlmKG1hcFRoZW1lVGFnICYmIG1hcFRoZW1lU3R5bGUpe1xuICAgICAgICBsZXQgdGhlbWUgPSBKU09OLnBhcnNlKG1hcFRoZW1lU3R5bGUpO1xuICAgICAgICBhdGxhcy5jaGFuZ2VNYXBTdHlsZShtYXAsIG1hcFRoZW1lVGFnLCB0aGVtZSk7XG4gICAgfVxuXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFwLCAnY2xpY2snLCBlID0+IHtcbiAgICAgICAgaWYoYXRsYXMuaXNTaGlmdENsaWNrKCkpe1xuICAgICAgICAgICAgbGV0IGNvb3JkID0gZS5sYXRMbmc7XG4gICAgICAgICAgICBsZXQgZW50cnkgPSBhdGxhcy5hZGREZWZhdWx0TWFya2VyKHtcbiAgICAgICAgICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgICAgICAgICBjb29yZDoge1xuICAgICAgICAgICAgICAgICAgICBsYXQ6IGNvb3JkLmxhdCgpLFxuICAgICAgICAgICAgICAgICAgICBsbmc6IGNvb3JkLmxuZygpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvKmF0bGFzLnVwZGF0ZU5hbWUoYXRsYXMubWFya2Vycy5sZW5ndGggLSAxKS50aGVuKGFkZGVkID0+IHtcbiAgICAgICAgICAgICAgICBpZighYWRkZWQpe1xuICAgICAgICAgICAgICAgICAgICBhdGxhcy5yZW1vdmVNYXJrZXIoYXRsYXMubWFya2Vycy5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTsqL1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICB2ZXguZGlhbG9nLnByb21wdCh7XG4gICAgICAgIG1lc3NhZ2U6ICdFbnRlciBhIGtleSB0byBjcmVhdGUgb3IgbG9hZCBhIG1hcDonLFxuICAgICAgICBjYWxsYmFjazogKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICBpZih2YWx1ZSl7XG4gICAgICAgICAgICAgICAgbGV0IGxvYWRlZCA9IGF0bGFzLmxvYWRNYXJrZXJzKHZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZihsb2FkZWQpe1xuICAgICAgICAgICAgICAgICAgICBsb2FkZWQuZm9yRWFjaChjb29yZCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb29yZC5tYXAgPSBtYXA7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdGxhcy5hZGREZWZhdWx0TWFya2VyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29yZDogY29vcmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogY29vcmQubmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgZmlyc3QgPSBhdGxhcy5tYXJrZXJzWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZmlyc3Qpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcC5zZXRDZW50ZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXQ6IGZpcnN0LmRhdGEubGF0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsbmc6IGZpcnN0LmRhdGEubG5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB2ZXguZGlhbG9nLmFsZXJ0KCdMb2FkZWQgZXhpc3RpbmcgbWFwOiAnICsgdmFsdWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgICAgICB2ZXguZGlhbG9nLmFsZXJ0KCdDcmVhdGVkIG5ldyBtYXA6ICcgKyB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHdpbmRvdy5NQVBfVEFHID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGxldCBpbXBvcnRDb29yZGluYXRlcyA9ICh0YWcpID0+IHtcbiAgICAgICAgdmV4LmRpYWxvZy5wcm9tcHQoe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0ltcG9ydCB5b3VyIGNvb3JkaW5hdGVzOicsXG4gICAgICAgICAgICBjYWxsYmFjazogKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGFnLCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGxldCBzaG9ydGN1dHNMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3J0Y3V0cy1saXN0Jyk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3J0Y3V0cycpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XG4gICAgICAgIGxldCBkaXNwbGF5TGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgZGlzcGxheUxpc3QuaW5uZXJIVE1MID0gc2hvcnRjdXRzTGlzdC5pbm5lckhUTUw7XG4gICAgICAgIHZleC5kaWFsb2cuYWxlcnQoe1xuICAgICAgICAgICAgdW5zYWZlTWVzc2FnZTogZGlzcGxheUxpc3Qub3V0ZXJIVE1MXG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgYXRsYXMuc2V0SG90S2V5KCdpJywgZSA9PiB7XG4gICAgICAgIHZleC5kaWFsb2cucHJvbXB0KHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdFbnRlciBhIGtleSBmb3IgdGhpcyBtYXA6JyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiAodGFnKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGV4aXN0aW5nID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0odGFnKTtcbiAgICAgICAgICAgICAgICBpZihleGlzdGluZyl7XG4gICAgICAgICAgICAgICAgICAgIHZleC5kaWFsb2cuY29uZmlybSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnVGhpcyB3aWxsIG92ZXJ3cml0ZSBhbiBleGlzdGluZyBtYXAsIGFyZSB5b3Ugc3VyZT8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6ICh5ZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih5ZXMpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnRDb29yZGluYXRlcyh0YWcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgaW1wb3J0Q29vcmRpbmF0ZXModGFnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgYXRsYXMuc2V0SG90S2V5KCdlJywgZSA9PiB7XG4gICAgICAgIHZleC5kaWFsb2cucHJvbXB0KHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdFeHBvcnRlZCBjb29yZGluYXRlczonLFxuICAgICAgICAgICAgdmFsdWU6IGF0bGFzLm1hcmtlcnNUb1N0cmluZyhhdGxhcy5tYXJrZXJzKSxcbiAgICAgICAgICAgIGNhbGxiYWNrOiAodmFsdWUpID0+IHt9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgYXRsYXMuc2V0SG90S2V5KCd0JywgZSA9PiB7XG4gICAgICAgIHZleC5kaWFsb2cucHJvbXB0KHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdFbnRlciBtYXAgdGhlbWUgVVJMOicsXG4gICAgICAgICAgICBjYWxsYmFjazogKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgYXRsYXMuZ2V0TWFwU3R5bGVCeVVSTCh2YWx1ZSkudGhlbihzdHlsZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdtYXAtdGhlbWUtdGFnJywgc3R5bGUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdtYXAtdGhlbWUtc3R5bGUnLCBzdHlsZS5qc29uKTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHRhZyA9IHN0eWxlLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIGxldCB0aGVtZSA9IEpTT04ucGFyc2Uoc3R5bGUuanNvbik7XG4gICAgICAgICAgICAgICAgICAgIGF0bGFzLmNoYW5nZU1hcFN0eWxlKG1hcCwgdGFnLCB0aGVtZSk7XG4gICAgICAgICAgICAgICAgICAgIHZleC5kaWFsb2cuYWxlcnQoJ0NoYW5nZWQgbWFwIHRoZW1lIHRvOiAnICsgdGFnKTtcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgICAgICAgICB2ZXguZGlhbG9nLmFsZXJ0KCdFcnJvcjogJyArIGVycik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG59KTsiXX0=\n"]}